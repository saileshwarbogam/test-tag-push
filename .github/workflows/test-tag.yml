name: Public Beta Release

on:
  push:
    tags: '*.*.*b*'

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout source code
        uses: actions/checkout@v2
        with:
          fetch-depth: 0

      - name: Get Branch
        id: get-branch
        run: |
          # Fetch all branches to ensure branch info is available
          git fetch --all
          
          # Find the branch containing the current tag
          BRANCH_NAME=$(git branch -r --contains ${{ github.sha }} | grep -o 'origin/.*' | sed 's|origin/||' | head -n 1)
          
          echo "Branch Name: $BRANCH_NAME"
          echo "branch_name=$BRANCH_NAME" >> $GITHUB_ENV

      - name: Print branch name
        run: |
          echo "Branch Name: $branch_name"
          
      - name: Push changes to branch
        run: |
          git push origin $branch_name -f
