name: Public Beta Release

on:
  push:
    tags: '*.*.*b*'

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout source code
        uses: actions/checkout@v2
        with:
          fetch-depth: 0

      - name: Get Branch
        id: get-branch
        run: |
          # Ensure all branch and tag information is available
          git fetch --all

          # Identify the branch containing the commit associated with the tag
          BRANCH_NAME=$(git branch -r --contains ${{ github.sha }} | grep -o 'origin/.*' | sed 's|origin/||' | head -n 1)
          
          # If no branch is found, fallback to default or fail
          if [ -z "$BRANCH_NAME" ]; then
            echo "No branch found for commit ${{ github.sha }}."
            exit 1
          fi

          echo "Branch Name: $BRANCH_NAME"
          echo "branch_name=$BRANCH_NAME" >> $GITHUB_ENV

      - name: Debug branch info
        run: |
          echo "Branch Name: $branch_name"
          git branch -r
          git log --oneline

      - name: Push changes to branch
        run: |
          git push origin $branch_name -f
